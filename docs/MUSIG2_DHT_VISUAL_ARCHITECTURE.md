# MuSig2 DHT Visual Architecture

**Version**: 1.0.0  
**Date**: November 3, 2025  
**Status**: Visual Guide & Architecture Overview

---

## Table of Contents

1. [System Overview](#system-overview)
2. [Network Architecture](#network-architecture)
3. [Identity Registration Flow](#identity-registration-flow)
4. [Advertisement & Discovery](#advertisement--discovery)
5. [Reputation System](#reputation-system)
6. [Security Layers](#security-layers)
7. [Session Coordination](#session-coordination)
8. [Data Flow Diagrams](#data-flow-diagrams)

---

## System Overview

### High-Level Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    MuSig2 P2P DHT Coordination System                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

                          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                          â”‚   Lotus Blockchain  â”‚
                          â”‚  (Identity Anchor)  â”‚
                          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                     â”‚
                          LOKAD Burn Transactions
                          (LTMS: 0x534D544C)
                                     â”‚
                                     â–¼
              â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”“
              â”ƒ     Blockchain-Anchored Identities       â”ƒ
              â”ƒ   (50 XPI burn = permanent identity)     â”ƒ
              â”—â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”¯â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”›
                                       â”‚
                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                â”‚                      â”‚                      â”‚
                â–¼                      â–¼                      â–¼
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚  Reputation   â”‚     â”‚   Discovery   â”‚     â”‚   Security    â”‚
        â”‚    Manager    â”‚     â”‚     Layer     â”‚     â”‚    Layer      â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
                â”‚                     â”‚                     â”‚
                â”‚                     â”‚                     â”‚
                â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                      â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚                                   â”‚
                    â–¼                                   â–¼
            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            â”‚   libp2p     â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚   Kademlia   â”‚
            â”‚   Network    â”‚                   â”‚     DHT      â”‚
            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚                                   â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚
                          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                          â”‚                   â”‚
                          â–¼                   â–¼
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚ GossipSubâ”‚       â”‚   P2P    â”‚
                    â”‚ Pub/Sub  â”‚       â”‚ Streams  â”‚
                    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Network Architecture

### Peer-to-Peer Topology

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        P2P Network Topology                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

         Alice (Wallet)              Bob (Wallet)           Charlie (Service)
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ Identity: 8f3a2b  â”‚      â”‚ Identity: 4d7e1c  â”‚    â”‚ Identity: a9c2f5 â”‚
    â”‚ Burn: 50 XPI      â”‚      â”‚ Burn: 50 XPI      â”‚    â”‚ Burn: 200 XPI    â”‚
    â”‚ Keys: 1           â”‚      â”‚ Keys: 2           â”‚    â”‚ Keys: 10         â”‚
    â”‚ Reputation: 85    â”‚      â”‚ Reputation: 92    â”‚    â”‚ Reputation: 78   â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              â”‚                          â”‚                        â”‚
              â”‚ libp2p                   â”‚ libp2p                 â”‚ libp2p
              â”‚ Connection               â”‚ Connection             â”‚ Connection
              â”‚                          â”‚                        â”‚
              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚                          â”‚
                           â–¼                          â–¼
                  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                  â”‚        DHT Network (Kademlia)            â”‚
                  â”‚                                          â”‚
                  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”‚
                  â”‚  â”‚ Routing â”‚      â”‚ Routing â”‚          â”‚
                  â”‚  â”‚ Table A â”‚â—„â”€â”€â”€â”€â–ºâ”‚ Table B â”‚          â”‚
                  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚
                  â”‚       â”‚                  â”‚              â”‚
                  â”‚       â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚
                  â”‚                â–¼                        â”‚
                  â”‚       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”             â”‚
                  â”‚       â”‚  Stored Records  â”‚             â”‚
                  â”‚       â”‚  - Identities    â”‚             â”‚
                  â”‚       â”‚  - Advertisementsâ”‚             â”‚
                  â”‚       â”‚  - Directory Idx â”‚             â”‚
                  â”‚       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜             â”‚
                  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                     â”‚
                    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                    â”‚                â”‚                â”‚
                    â–¼                â–¼                â–¼
            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            â”‚ GossipSubâ”‚     â”‚ GossipSubâ”‚     â”‚ GossipSubâ”‚
            â”‚ Topic A  â”‚     â”‚ Topic B  â”‚     â”‚ Topic C  â”‚
            â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         musig2:signers:  musig2:signers:  musig2:signers:
              spend            swap           coinjoin
```

---

## Identity Registration Flow

### Step 1: Create Burn Transaction

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              Identity Registration Transaction Flow                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

   Wallet                    Transaction                  Blockchain
  â”Œâ”€â”€â”€â”€â”€â”€â”                  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”               â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚Alice â”‚                  â”‚   Build   â”‚               â”‚   Lotus   â”‚
  â””â”€â”€â”€â”¬â”€â”€â”˜                  â”‚   Tx      â”‚               â”‚   Node    â”‚
      â”‚                     â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜               â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
      â”‚                           â”‚                           â”‚
      â”‚ 1. Generate Identity      â”‚                           â”‚
      â”‚    - Private Key          â”‚                           â”‚
      â”‚    - Public Key           â”‚                           â”‚
      â”‚    - Timestamp            â”‚                           â”‚
      â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚                           â”‚
      â”‚                           â”‚                           â”‚
      â”‚ 2. Build OP_RETURN        â”‚                           â”‚
      â”‚    Output:                â”‚                           â”‚
      â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚                           â”‚
      â”‚    â”‚ OP_RETURN        â”‚  â”‚                           â”‚
      â”‚    â”‚ LOKAD: LTMS      â”‚  â”‚                           â”‚
      â”‚    â”‚ Version: 0x01    â”‚  â”‚                           â”‚
      â”‚    â”‚ PubKey: 02ab...  â”‚  â”‚                           â”‚
      â”‚    â”‚ Time: 173041...  â”‚  â”‚                           â”‚
      â”‚    â”‚ Satoshis: 50 XPI â”‚  â”‚  â† ğŸ”¥ BURNED             â”‚
      â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚                           â”‚
      â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚                           â”‚
      â”‚                           â”‚                           â”‚
      â”‚ 3. Add Change Output      â”‚                           â”‚
      â”‚    - Return excess funds  â”‚                           â”‚
      â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚                           â”‚
      â”‚                           â”‚                           â”‚
      â”‚ 4. Sign Transaction       â”‚                           â”‚
      â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚                           â”‚
      â”‚                           â”‚                           â”‚
      â”‚                           â”‚ 5. Broadcast              â”‚
      â”‚                           â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚
      â”‚                           â”‚                           â”‚
      â”‚                           â”‚                           â”‚ 6. Mine Block
      â”‚                           â”‚                           â”‚    Confirm Tx
      â”‚                           â”‚                           â”‚
      â”‚                           â”‚ 7. Confirmation           â”‚
      â”‚                           â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
      â”‚ 8. Identity ID:           â”‚                           â”‚
      â”‚    SHA256(txid + idx)     â”‚                           â”‚
      â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                           â”‚
      â”‚    = 8f3a2b1c...          â”‚                           â”‚
      â”‚                           â”‚                           â”‚

Identity Created! âœ…
- identityId: 8f3a2b1c...
- burnTxId: abc123...
- burnAmount: 50,000,000 satoshis (50 XPI)
- publicKey: 02abcd...
```

### Step 2: Register Identity in P2P Network

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚            Identity Registration in P2P Network                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Alice's Coordinator                 DHT Network              Reputation Manager
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚               â”‚                  â”‚          â”‚            â”‚                 â”‚
â”‚ 1. Verify     â”‚                  â”‚          â”‚            â”‚                 â”‚
â”‚    Burn Tx    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚          â”‚            â”‚                 â”‚
â”‚    On-Chain   â”‚         â”‚        â”‚          â”‚            â”‚                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚        â”‚          â”‚            â”‚                 â”‚
        â”‚                 â”‚        â”‚          â”‚            â”‚                 â”‚
        â”‚ Lotus RPC       â”‚        â”‚          â”‚            â”‚                 â”‚
        â”‚ getRawTx()      â”‚        â”‚          â”‚            â”‚                 â”‚
        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚        â”‚          â”‚            â”‚                 â”‚
                          â”‚        â”‚          â”‚            â”‚                 â”‚
        â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚          â”‚            â”‚                 â”‚
        â”‚                          â”‚          â”‚            â”‚                 â”‚
        â–¼                          â”‚          â”‚            â”‚                 â”‚
   âœ… Verified:                    â”‚          â”‚            â”‚                 â”‚
   - 6+ confirmations              â”‚          â”‚            â”‚                 â”‚
   - Valid LOKAD prefix            â”‚          â”‚            â”‚                 â”‚
   - Sufficient burn amount        â”‚          â”‚            â”‚                 â”‚
        â”‚                          â”‚          â”‚            â”‚                 â”‚
        â”‚ 2. Create Identity       â”‚          â”‚            â”‚                 â”‚
        â”‚    Structure             â”‚          â”‚            â”‚                 â”‚
        â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚                 â”‚
        â”‚                          â”‚          â”‚            â”‚ 3. Initialize   â”‚
        â”‚                          â”‚          â”‚            â”‚    Reputation   â”‚
        â”‚                          â”‚          â”‚            â”‚    Score: 50    â”‚
        â”‚                          â”‚          â”‚            â”‚    (Neutral)    â”‚
        â”‚                          â”‚          â”‚            â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚                          â”‚          â”‚                     â”‚
        â”‚ 4. Announce to DHT       â”‚          â”‚                     â”‚
        â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚          â”‚                     â”‚
        â”‚    Key: identity:8f3a2b  â”‚ 5. Store â”‚                     â”‚
        â”‚    Value: {              â”‚          â”‚                     â”‚
        â”‚      identityId,         â”‚          â”‚                     â”‚
        â”‚      burnProof,          â”‚          â”‚                     â”‚
        â”‚      publicKey           â”‚          â”‚                     â”‚
        â”‚    }                     â”‚          â”‚                     â”‚
        â”‚                          â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜                     â”‚
        â”‚                               â”‚                           â”‚
        â”‚                               â”‚ 6. Replicate              â”‚
        â”‚                               â”‚    to k=20 nodes          â”‚
        â”‚                               â”‚                           â”‚
        â”‚ 7. Store Locally             â”‚                           â”‚
        â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
        â”‚                              â”‚                           â”‚
        â–¼                              â–¼                           â–¼
   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”           â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
   â”‚ Local Cache  â”‚           â”‚ DHT Network  â”‚          â”‚  Reputation  â”‚
   â”‚              â”‚           â”‚              â”‚          â”‚   Database   â”‚
   â”‚ identity:    â”‚           â”‚ Replicated   â”‚          â”‚              â”‚
   â”‚ 8f3a2b...    â”‚           â”‚ 20 nodes     â”‚          â”‚ identityId:  â”‚
   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜           â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚ 8f3a2b...    â”‚
                                                         â”‚ score: 50    â”‚
                                                         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Identity Registered! âœ…
```

---

## Advertisement & Discovery

### Signer Advertisement Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Signer Advertisement Flow                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

    Alice                        P2P Network                    Bob
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”                                                  â”Œâ”€â”€â”€â”€â”€â”€â”€â”
  â”‚Wallet â”‚                                                  â”‚Wallet â”‚
  â””â”€â”€â”€â”¬â”€â”€â”€â”˜                                                  â””â”€â”€â”€â”¬â”€â”€â”€â”˜
      â”‚                                                          â”‚
      â”‚ 1. advertiseSigner()                                    â”‚
      â”‚    - IdentityId: 8f3a2b                                 â”‚
      â”‚    - Criteria: {types: ['spend', 'swap']}              â”‚
      â”‚    - Metadata: {reputation: {...}}                      â”‚
      â”‚                                                          â”‚
      â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                               â”‚
      â”‚         â”‚ 2. Rate Limit Check âœ…                        â”‚
      â”‚         â”‚    (< 1 per 60 seconds)                       â”‚
      â”‚         â”‚                                               â”‚
      â”‚         â”‚ 3. Key Count Check âœ…                         â”‚
      â”‚         â”‚    (< 10 keys per peer)                       â”‚
      â”‚         â”‚                                               â”‚
      â”‚         â”‚ 4. Sign Advertisement                         â”‚
      â”‚         â”‚    Signature = Schnorr(SHA256(ad), privKey)  â”‚
      â”‚         â”‚                                               â”‚
      â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                               â”‚
      â”‚                                                          â”‚
      â”‚ 5. MULTI-CHANNEL BROADCAST                              â”‚
      â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
      â”‚                                                          â”‚
      â”‚ A) DHT Storage                                          â”‚
      â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”               â”‚
      â”‚                     â”‚   DHT Network    â”‚               â”‚
      â”‚                     â”‚                  â”‚               â”‚
      â”‚    Keys Stored:     â”‚ â€¢ musig2-signer: â”‚               â”‚
      â”‚    â€¢ type:spend:... â”‚   type:spend:8f3aâ”‚               â”‚
      â”‚    â€¢ type:swap:...  â”‚ â€¢ type:swap:8f3a â”‚               â”‚
      â”‚    â€¢ all:8f3a2b...  â”‚ â€¢ all:8f3a2b     â”‚               â”‚
      â”‚                     â”‚                  â”‚               â”‚
      â”‚                     â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â”‚
      â”‚                              â”‚                         â”‚
      â”‚ B) GossipSub Topics         â”‚                         â”‚
      â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”Œâ”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”               â”‚
      â”‚                     â”‚  Topic: spend    â”‚               â”‚
      â”‚    Publish to:      â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤               â”‚
      â”‚    â€¢ musig2:signers:â”‚  Topic: swap     â”‚               â”‚
      â”‚      spend          â””â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â”‚
      â”‚    â€¢ musig2:signers:        â”‚                          â”‚
      â”‚      swap                   â”‚ C) INSTANT DELIVERY      â”‚
      â”‚                             â”‚    (10-100ms latency)    â”‚
      â”‚                             â”‚                          â”‚
      â”‚                             â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚
      â”‚                                                         â”‚
      â”‚ D) Direct P2P Broadcast                                â”‚
      â”‚    (to connected peers)                                â”‚
      â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚
      â”‚                                                         â”‚
      â”‚                                                         â”‚ 6. Receive
      â”‚                                                         â”‚    Advertisement
      â”‚                                                         â”‚
      â”‚                                                         â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”
      â”‚                                                         â”‚        â”‚
      â”‚                                                         â”‚ 7. Security
      â”‚                                                         â”‚    Validation:
      â”‚                                                         â”‚    âœ… Size < 10KB
      â”‚                                                         â”‚    âœ… Timestamp OK
      â”‚                                                         â”‚    âœ… Not expired
      â”‚                                                         â”‚    âœ… Signature OK
      â”‚                                                         â”‚    âœ… Identity valid
      â”‚                                                         â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”˜
      â”‚                                                         â”‚
      â”‚                                                         â”‚ 8. Store in
      â”‚                                                         â”‚    Local Cache
      â”‚                                                         â”‚
      â”‚                                                         â”‚ 9. Emit Event:
      â”‚                                                         â”‚    SIGNER_DISCOVERED
      â”‚                                                         â”‚
```

### Signer Discovery Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      Signer Discovery Flow                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

    Bob                                                         DHT Network
  â”Œâ”€â”€â”€â”€â”€â”€â”€â”                                                   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
  â”‚Wallet â”‚                                                   â”‚            â”‚
  â””â”€â”€â”€â”¬â”€â”€â”€â”˜                                                   â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
      â”‚                                                              â”‚
      â”‚ 1. findAvailableSigners({                                   â”‚
      â”‚      transactionType: 'spend',                              â”‚
      â”‚      minAmount: 5_000_000,                                  â”‚
      â”‚      minReputation: 70                                      â”‚
      â”‚    })                                                       â”‚
      â”‚                                                              â”‚
      â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                                  â”‚
      â”‚          â”‚ 2. Check Local Cache First (Fast Path)          â”‚
      â”‚          â”‚                                                  â”‚
      â”‚          â”‚    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”              â”‚
      â”‚          â”‚    â”‚  Local Signer Cache         â”‚              â”‚
      â”‚          â”‚    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤              â”‚
      â”‚          â”œâ”€â”€â”€â–ºâ”‚ â€¢ Alice (rep: 85, spend) âœ… â”‚              â”‚
      â”‚          â”‚    â”‚ â€¢ Charlie (rep: 78, swap) âŒâ”‚              â”‚
      â”‚          â”‚    â”‚ â€¢ Dave (rep: 45, spend) âŒ  â”‚              â”‚
      â”‚          â”‚    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜              â”‚
      â”‚          â”‚                                                  â”‚
      â”‚          â”‚    Matches: 1 (Alice)                           â”‚
      â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                                  â”‚
      â”‚                                                              â”‚
      â”‚ 3. Query DHT for More (if needed)                           â”‚
      â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º
      â”‚    Query: "musig2-directory-index:spend"                    â”‚
      â”‚                                                              â”‚
      â”‚                                              4. DHT Lookup  â”‚
      â”‚                                                 (O(log n))  â”‚
      â”‚                                                 â”Œâ”€â”€â”€â”€â”€â”€â”€â”   â”‚
      â”‚                                                 â”‚Node 1 â”‚   â”‚
      â”‚                                                 â””â”€â”€â”€â”¬â”€â”€â”€â”˜   â”‚
      â”‚                                                     â”‚       â”‚
      â”‚                                                 â”Œâ”€â”€â”€â–¼â”€â”€â”€â”   â”‚
      â”‚                                                 â”‚Node 2 â”‚   â”‚
      â”‚                                                 â””â”€â”€â”€â”¬â”€â”€â”€â”˜   â”‚
      â”‚                                                     â”‚       â”‚
      â”‚                                                 â”Œâ”€â”€â”€â–¼â”€â”€â”€â”   â”‚
      â”‚                                                 â”‚Target â”‚   â”‚
      â”‚                                                 â””â”€â”€â”€â”¬â”€â”€â”€â”˜   â”‚
      â”‚                                                     â”‚       â”‚
      â”‚ 5. Return Directory Index                          â”‚       â”‚
      â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚
      â”‚    {                                                        â”‚
      â”‚      entries: [                                             â”‚
      â”‚        {pubKey: '8f3a...', sig: '...'},                    â”‚
      â”‚        {pubKey: 'e2d9...', sig: '...'},                    â”‚
      â”‚      ]                                                      â”‚
      â”‚    }                                                        â”‚
      â”‚                                                              â”‚
      â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                                  â”‚
      â”‚          â”‚ 6. Verify Each Entry                            â”‚
      â”‚          â”‚    - Check signature                            â”‚
      â”‚          â”‚    - Verify not expired                         â”‚
      â”‚          â”‚    - Filter by criteria                         â”‚
      â”‚          â”‚                                                  â”‚
      â”‚          â”‚ 7. Query Individual Ads                         â”‚
      â”‚          â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º
      â”‚          â”‚    "musig2-directory:spend:8f3a..."             â”‚
      â”‚          â”‚                                                  â”‚
      â”‚          â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
      â”‚          â”‚    Advertisement Details                        â”‚
      â”‚          â”‚                                                  â”‚
      â”‚          â”‚ 8. Apply Filters:                               â”‚
      â”‚          â”‚    âœ… transactionType matches                   â”‚
      â”‚          â”‚    âœ… amount range OK                           â”‚
      â”‚          â”‚    âœ… reputation >= 70                          â”‚
      â”‚          â”‚    âœ… identity verified                         â”‚
      â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                                                  â”‚
      â”‚                                                              â”‚
      â”‚ 9. Return Results:                                          â”‚
      â”‚    [                                                        â”‚
      â”‚      {                                                      â”‚
      â”‚        identityId: '8f3a2b...',                            â”‚
      â”‚        publicKey: '02abcd...',                             â”‚
      â”‚        reputation: {score: 85, ...},                       â”‚
      â”‚        peerId: '12D3Koo...',                               â”‚
      â”‚        multiaddrs: ['/ip4/...']                            â”‚
      â”‚      },                                                     â”‚
      â”‚      ...                                                    â”‚
      â”‚    ]                                                        â”‚
      â”‚                                                              â”‚

Discovery Complete! âœ…
Bob found 3 signers matching criteria
```

---

## Reputation System

### Reputation Lifecycle

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      Reputation Lifecycle                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

TIME â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–º

T0: Identity Creation
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Identity: 8f3a2b...                    â”‚
â”‚ Burn: 50 XPI                           â”‚
â”‚ Score: 50 (Neutral Start)              â”‚
â”‚ Completed: 0                           â”‚
â”‚ Failed: 0                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚
                    â”‚ First Signing Session
                    â–¼
T1: Session Complete (Success)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Score: 50 â†’ 58                         â”‚  Formula:
â”‚ Completed: 0 â†’ 1                       â”‚  â€¢ Success rate: 100% Ã— 60 = 60pts
â”‚ Failed: 0                              â”‚  â€¢ Volume: 1/10 = 0.1pts
â”‚ Response Time: 2500ms                  â”‚  â€¢ Speed: 2.5s = 20pts
â”‚                                        â”‚  Total: 60 + 0.1 + 20 = 80.1
â”‚ Calculation:                           â”‚  But first session: 58
â”‚ â€¢ Success: 1/1 = 100% â†’ 60pts         â”‚
â”‚ â€¢ Volume: 1 signing â†’ 0.1pts          â”‚
â”‚ â€¢ Speed: 2.5s â†’ 20pts                 â”‚
â”‚ â†’ Score = 58 (weighted avg)           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚
                    â”‚ Multiple successful sessions
                    â–¼
T2: After 10 Sessions (8 success, 2 fail)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Score: 58 â†’ 72                         â”‚
â”‚ Completed: 1 â†’ 8                       â”‚
â”‚ Failed: 0 â†’ 2                          â”‚
â”‚ Response Time: 2200ms (avg)            â”‚
â”‚                                        â”‚
â”‚ Calculation:                           â”‚
â”‚ â€¢ Success: 8/10 = 80% â†’ 48pts         â”‚
â”‚ â€¢ Volume: 10 signings â†’ 1pt           â”‚
â”‚ â€¢ Speed: 2.2s â†’ 20pts                 â”‚
â”‚ â†’ Score = 69 + penalties = 72         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚
                    â”‚ Many successful sessions
                    â–¼
T3: After 100 Sessions (95 success, 5 fail)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Score: 72 â†’ 89                         â”‚
â”‚ Completed: 8 â†’ 95                      â”‚
â”‚ Failed: 2 â†’ 5                          â”‚
â”‚ Response Time: 1800ms (avg)            â”‚
â”‚                                        â”‚
â”‚ Calculation:                           â”‚
â”‚ â€¢ Success: 95/100 = 95% â†’ 57pts       â”‚
â”‚ â€¢ Volume: 100 signings â†’ 10pts        â”‚
â”‚ â€¢ Speed: 1.8s â†’ 20pts                 â”‚
â”‚ â†’ Score = 87 + bonuses = 89           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚
                    â”‚ Key rotation (no reputation loss!)
                    â–¼
T4: Key Rotation
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Identity: 8f3a2b... (UNCHANGED)        â”‚
â”‚ Old Key: 02abcd... â†’ REVOKED           â”‚
â”‚ New Key: 03ef12... â†’ ACTIVE            â”‚
â”‚                                        â”‚
â”‚ Score: 89 (PRESERVED!) âœ…              â”‚
â”‚ Completed: 95 (PRESERVED!) âœ…          â”‚
â”‚ Failed: 5 (PRESERVED!) âœ…              â”‚
â”‚                                        â”‚
â”‚ Key History:                           â”‚
â”‚ â€¢ 02abcd... (revoked at T4)           â”‚
â”‚ â€¢ 03ef12... (active since T4)         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚
                    â”‚ Bad behavior
                    â–¼
T5: Multiple Failures
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Score: 89 â†’ 72                         â”‚
â”‚ Completed: 95                          â”‚
â”‚ Failed: 5 â†’ 12                         â”‚
â”‚                                        â”‚
â”‚ Penalties Applied:                     â”‚
â”‚ â€¢ Timeout: -5 pts (Ã—3 times)          â”‚
â”‚ â€¢ Disconnect: -10 pts (Ã—2 times)      â”‚
â”‚ â€¢ Invalid sig: -20 pts (Ã—2 times)     â”‚
â”‚ Total: -15 - 20 - 40 = -75pts         â”‚
â”‚                                        â”‚
â”‚ New Score: 89 - 17 = 72               â”‚
â”‚ (with smoothing and caps)              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Reputation is:
âœ… Tied to identityId (not public key)
âœ… Tracked automatically
âœ… Updated on every session
âœ… Preserved across key rotation
âœ… Protected by 50 XPI burn
```

### Reputation Score Calculation

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Reputation Score Formula                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Total Score = Success Points + Volume Points + Speed Points
              â””â”€â”€â”€â”€(0-60)â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€(0-20)â”€â”€â”€â”˜  â””â”€â”€â”€(0-20)â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 1. SUCCESS POINTS (0-60 points)                                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                  â”‚
â”‚   Success Rate = completedSignings / totalSignings              â”‚
â”‚   Points = Success Rate Ã— 60                                    â”‚
â”‚                                                                  â”‚
â”‚   Examples:                                                     â”‚
â”‚   â€¢ 100% success (10/10) = 60 pts  (Perfect!)                  â”‚
â”‚   â€¢ 90% success (90/100) = 54 pts  (Excellent)                 â”‚
â”‚   â€¢ 80% success (80/100) = 48 pts  (Good)                      â”‚
â”‚   â€¢ 50% success (50/100) = 30 pts  (Poor)                      â”‚
â”‚                                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 2. VOLUME POINTS (0-20 points)                                   â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                  â”‚
â”‚   Volume Bonus = min(20, totalSignings / 10)                   â”‚
â”‚                                                                  â”‚
â”‚   Examples:                                                     â”‚
â”‚   â€¢ 1 signing    = 0.1 pts  (New)                              â”‚
â”‚   â€¢ 10 signings  = 1 pt     (Beginner)                         â”‚
â”‚   â€¢ 50 signings  = 5 pts    (Active)                           â”‚
â”‚   â€¢ 100 signings = 10 pts   (Experienced)                      â”‚
â”‚   â€¢ 200+ signings = 20 pts  (Veteran) - capped                â”‚
â”‚                                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 3. SPEED POINTS (0-20 points)                                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                  â”‚
â”‚   Based on averageResponseTime:                                 â”‚
â”‚                                                                  â”‚
â”‚   â€¢ < 5 seconds  = 20 pts  (Instant)                           â”‚
â”‚   â€¢ 5-10 seconds = 10 pts  (Fast)                              â”‚
â”‚   â€¢ 10-30 seconds = 5 pts  (Slow)                              â”‚
â”‚   â€¢ > 30 seconds  = 0 pts  (Very Slow)                         â”‚
â”‚                                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ EXAMPLE CALCULATIONS                                             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                  â”‚
â”‚ Alice (Veteran):                                                â”‚
â”‚ â€¢ 95 completed, 5 failed (100 total)                           â”‚
â”‚ â€¢ Success rate: 95% â†’ 57 pts                                   â”‚
â”‚ â€¢ Volume: 100 signings â†’ 10 pts                                â”‚
â”‚ â€¢ Avg response: 2.5s â†’ 20 pts                                  â”‚
â”‚ TOTAL: 87 pts (Excellent!)                                     â”‚
â”‚                                                                  â”‚
â”‚ Bob (Experienced):                                              â”‚
â”‚ â€¢ 48 completed, 2 failed (50 total)                            â”‚
â”‚ â€¢ Success rate: 96% â†’ 58 pts                                   â”‚
â”‚ â€¢ Volume: 50 signings â†’ 5 pts                                  â”‚
â”‚ â€¢ Avg response: 8s â†’ 10 pts                                    â”‚
â”‚ TOTAL: 73 pts (Good)                                           â”‚
â”‚                                                                  â”‚
â”‚ Charlie (Beginner):                                             â”‚
â”‚ â€¢ 8 completed, 2 failed (10 total)                             â”‚
â”‚ â€¢ Success rate: 80% â†’ 48 pts                                   â”‚
â”‚ â€¢ Volume: 10 signings â†’ 1 pt                                   â”‚
â”‚ â€¢ Avg response: 15s â†’ 5 pts                                    â”‚
â”‚ TOTAL: 54 pts (Needs improvement)                              â”‚
â”‚                                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ FAILURE PENALTIES (Immediate)                                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                  â”‚
â”‚ â€¢ Timeout:      -5 pts   (Slow but not malicious)              â”‚
â”‚ â€¢ Disconnect:   -10 pts  (Network issue or abandonment)        â”‚
â”‚ â€¢ Invalid sig:  -20 pts  (Serious error or attack)            â”‚
â”‚ â€¢ Abort:        -3 pts   (Changed mind, minor)                 â”‚
â”‚                                                                  â”‚
â”‚ Score cannot go below 0                                         â”‚
â”‚                                                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Security Layers

### Defense in Depth Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      Security Layer Stack                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

INCOMING MESSAGE FLOW (bottom to top)
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Layer 7: Application Logic
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ â€¢ Reputation scoring                                              â”‚
â”‚ â€¢ Session management                                              â”‚
â”‚ â€¢ Business logic validation                                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â–²
                              â”‚ Clean data âœ…
                              â”‚
Layer 6: Identity Verification
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ âœ… Check: Is identity registered?                                â”‚
â”‚ âœ… Check: Is burn transaction valid on-chain?                    â”‚
â”‚ âœ… Check: Does identity own claimed public key?                  â”‚
â”‚ âœ… Check: Is key rotation history valid?                         â”‚
â”‚                                                                  â”‚
â”‚ âŒ Drop if: No valid identity or burn proof                     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â–²
                              â”‚
Layer 5: Rate Limiting & Quotas
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ âœ… Check: Last advertisement > 60 seconds ago?                   â”‚
â”‚ âœ… Check: Peer has < 10 public keys?                            â”‚
â”‚ âœ… Check: Invalid signatures < 10?                               â”‚
â”‚                                                                  â”‚
â”‚ âŒ Drop if: Rate limit exceeded                                 â”‚
â”‚ âŒ Ban if: Repeated violations                                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â–²
                              â”‚
Layer 4: Cryptographic Validation
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ âœ… Verify: Schnorr signature valid?                             â”‚
â”‚ âœ… Verify: Public key matches claimed identity?                 â”‚
â”‚ âœ… Verify: Message hasn't been tampered with?                   â”‚
â”‚                                                                  â”‚
â”‚ âŒ Drop if: Invalid signature                                   â”‚
â”‚ âŒ Record: Invalid signature attempt                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â–²
                              â”‚
Layer 3: Content Validation
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ âœ… Check: Message size < 10KB?                                  â”‚
â”‚ âœ… Check: Timestamp within 5 minutes?                           â”‚
â”‚ âœ… Check: Not expired (expiresAt > now)?                        â”‚
â”‚ âœ… Check: Valid JSON structure?                                 â”‚
â”‚                                                                  â”‚
â”‚ âŒ Drop if: Oversized or malformed                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â–²
                              â”‚
Layer 2: Peer Reputation
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ âœ… Check: Is peer blacklisted?                                  â”‚
â”‚ âœ… Check: Is peer graylisted?                                   â”‚
â”‚ âœ… Check: Peer reputation score acceptable?                     â”‚
â”‚                                                                  â”‚
â”‚ âŒ Drop if: Blacklisted (permanent)                            â”‚
â”‚ âŒ Drop if: Graylisted (temporary)                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â–²
                              â”‚
Layer 1: Network Transport
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ libp2p Security:                                                 â”‚
â”‚ â€¢ Noise encryption (end-to-end)                                 â”‚
â”‚ â€¢ Peer authentication                                            â”‚
â”‚ â€¢ Connection encryption                                          â”‚
â”‚                                                                  â”‚
â”‚ âœ… Encrypted connection                                         â”‚
â”‚ âœ… Authenticated peer                                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â–²
                              â”‚
                     RAW NETWORK MESSAGE
â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

Each layer filters malicious/invalid messages before they reach
application logic. Attack surface minimized at every level.
```

### Attack Mitigation Map

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        Attack â†’ Defense Map                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Attack Type                Defense Layer               Cost to Attacker
â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€

ğŸ”´ Spam Attack
   (1000 ads/sec)          â†’ Rate Limiter              FREE (blocked)
                           â†’ Auto-ban after 10

ğŸ”´ Sybil Attack
   (10,000 identities)     â†’ Burn requirement          500,000 XPI
                           â†’ Key limits per peer        (~$500k USD)

ğŸ”´ DHT Pollution
   (Stale entries)         â†’ Expiry checks             Time-limited
                           â†’ Automatic cleanup          Auto-removed

ğŸ”´ Reputation Gaming
   (Discard bad rep)       â†’ Identity-based tracking   50 XPI per identity
                           â†’ Blockchain anchor          Cannot discard

ğŸŸ  Invalid Signatures
   (CPU exhaustion)        â†’ Invalid sig counter       Max 10 attempts
                           â†’ Auto-ban                   â†’ Blacklist

ğŸŸ  Key Rotation Attack
   (Steal reputation)      â†’ Dual-key signature        Mathematically
                           â†’ History tracking           impossible

ğŸŸ¡ Message Flooding
   (Oversized payloads)    â†’ Size limits (10KB)        Immediate drop
                           â†’ Stream abortion

ğŸŸ¡ Time-Based Attacks
   (Future/past msgs)      â†’ Timestamp validation      5-minute window
                           â†’ Clock skew limits

ğŸŸ¡ Replay Attacks
   (Reuse old msgs)        â†’ Expiry timestamps         Time-limited
                           â†’ Nonce tracking

ğŸŸ¡ Eclipse Attack
   (Isolate peer)          â†’ Multiple bootstrap        DHT redundancy
                           â†’ DHT replication (k=20)

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

CRITICAL: All defenses are automatic and layered
No single point of failure
```

---

## Session Coordination

### Complete MuSig2 Signing Session

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              Complete MuSig2 Session with Identity                  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

 Alice (8f3a2b)        Bob (4d7e1c)         Charlie (a9c2f5)
    Identity             Identity              Identity
   50 XPI burn         50 XPI burn          200 XPI burn
   Rep: 85             Rep: 92              Rep: 78
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚            â”‚      â”‚            â”‚       â”‚            â”‚
â”‚ PHASE 0:   â”‚      â”‚ PHASE 0:   â”‚       â”‚ PHASE 0:   â”‚
â”‚ Advertise  â”‚      â”‚ Advertise  â”‚       â”‚ Advertise  â”‚
â”‚            â”‚      â”‚            â”‚       â”‚            â”‚
â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜       â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
      â”‚                   â”‚                    â”‚
      â”‚ 1. Advertise      â”‚ 1. Advertise       â”‚ 1. Advertise
      â”‚    Available       â”‚    Available        â”‚    Available
      â”‚    (spend)        â”‚    (spend)          â”‚    (spend, swap)
      â”‚                   â”‚                    â”‚
      â–¼                   â–¼                    â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚           DHT + GossipSub Network          â”‚
    â”‚                                            â”‚
    â”‚  Indexed by:                               â”‚
    â”‚  â€¢ type:spend â†’ [Alice, Bob, Charlie]     â”‚
    â”‚  â€¢ type:swap â†’ [Charlie]                  â”‚
    â”‚  â€¢ Reputation scores included              â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
                           â”‚ 2. Alice discovers
                           â”‚    available signers
                           â”‚
                           â–¼
      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
      â”‚ Alice queries: findAvailableSignersâ”‚
      â”‚ Filters: {                         â”‚
      â”‚   type: 'spend',                   â”‚
      â”‚   minReputation: 70                â”‚
      â”‚ }                                  â”‚
      â”‚                                    â”‚
      â”‚ Results:                           â”‚
      â”‚ â€¢ Bob (rep: 92) âœ…                 â”‚
      â”‚ â€¢ Charlie (rep: 78) âœ…             â”‚
      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
                           â”‚ 3. Alice creates
                           â”‚    signing request
                           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚            â”‚      â”‚            â”‚       â”‚            â”‚
â”‚ PHASE 1-2: â”‚      â”‚ PHASE 1-2: â”‚       â”‚ PHASE 1-2: â”‚
â”‚ Request    â”‚â”€â”€â”€â”€â”€â”€â–ºâ”‚ Discover   â”‚â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚ Discover   â”‚
â”‚ Created    â”‚      â”‚ & Join     â”‚       â”‚ & Join     â”‚
â”‚            â”‚      â”‚            â”‚       â”‚            â”‚
â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜       â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
      â”‚                   â”‚                    â”‚
      â”‚ 4. Announce       â”‚                    â”‚
      â”‚    Request        â”‚                    â”‚
      â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚ 5. Receive request â”‚
      â”‚                   â”‚    - Verify Alice  â”‚
      â”‚                   â”‚      identity      â”‚
      â”‚                   â”‚    - Check my key  â”‚
      â”‚                   â”‚      is required   â”‚
      â”‚                   â”‚    - User approves â”‚
      â”‚                   â”‚                    â”‚
      â”‚                   â”‚ 6. joinRequest()   â”‚
      â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                    â”‚
      â”‚                   â”‚                    â”‚
      â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ 7. joinRequest()
      â”‚                   â”‚                    â”‚
      â”‚                   â”‚                    â”‚
      â”‚ 8. ALL participants joined!            â”‚
      â”‚    Create local MuSig2 session         â”‚
      â”‚                   â”‚                    â”‚
â”Œâ”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”       â”Œâ”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”
â”‚            â”‚      â”‚            â”‚       â”‚            â”‚
â”‚ PHASE 3:   â”‚      â”‚ PHASE 3:   â”‚       â”‚ PHASE 3:   â”‚
â”‚ Signing    â”‚â—„â”€â”€â”€â”€â–ºâ”‚ Signing    â”‚â—„â”€â”€â”€â”€â”€â–ºâ”‚ Signing    â”‚
â”‚            â”‚      â”‚            â”‚       â”‚            â”‚
â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜       â””â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
      â”‚                   â”‚                    â”‚
      â”‚ 9. Round 1: Nonce Exchange             â”‚
      â”‚                   â”‚                    â”‚
      â”‚ NONCE_SHARE       â”‚                    â”‚
      â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚                    â”‚
      â”‚                   â”‚ NONCE_SHARE        â”‚
      â”‚                   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚
      â”‚                   â”‚                    â”‚
      â”‚                   â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ NONCE_SHARE
      â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                    â”‚
      â”‚                   â”‚                    â”‚
      â”‚ 10. All nonces collected               â”‚
      â”‚     Each node has [R1, R2] from all    â”‚
      â”‚                   â”‚                    â”‚
      â”‚ 11. Round 2: Partial Signatures        â”‚
      â”‚                   â”‚                    â”‚
      â”‚ PARTIAL_SIG       â”‚                    â”‚
      â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚                    â”‚
      â”‚                   â”‚ PARTIAL_SIG        â”‚
      â”‚                   â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–ºâ”‚
      â”‚                   â”‚                    â”‚
      â”‚                   â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤ PARTIAL_SIG
      â”‚â—„â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤                    â”‚
      â”‚                   â”‚                    â”‚
      â”‚ 12. All partial sigs collected         â”‚
      â”‚     Aggregate: s = s1 + s2 + s3       â”‚
      â”‚                   â”‚                    â”‚
      â”‚ 13. Final Signature Complete! âœ…       â”‚
      â”‚     (R, s) = Schnorr signature         â”‚
      â”‚                   â”‚                    â”‚
      â–¼                   â–¼                    â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Reputation â”‚      â”‚ Reputation â”‚       â”‚ Reputation â”‚
â”‚ Update:    â”‚      â”‚ Update:    â”‚       â”‚ Update:    â”‚
â”‚ 85 â†’ 86 âœ… â”‚      â”‚ 92 â†’ 93 âœ… â”‚       â”‚ 78 â†’ 79 âœ… â”‚
â”‚ +1 signing â”‚      â”‚ +1 signing â”‚       â”‚ +1 signing â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

Session Complete! âœ…
All reputations updated automatically
```

---

## Data Flow Diagrams

### Identity â†’ Advertisement â†’ Discovery â†’ Session

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Complete Data Flow Overview                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  1. IDENTITY LAYER   â”‚
â”‚  (Blockchain)        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â”‚ Burn Transaction
           â”‚ LOKAD: LTMS (0x534D544C)
           â”‚ Amount: 50 XPI
           â”‚
           â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚  identityId â”‚ â—„â”€â”€â”€ SHA256(txid + outputIdx)
    â”‚  8f3a2b...  â”‚
    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â”‚ Permanent anchor
           â”‚ Cannot be discarded
           â”‚
           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  2. REPUTATION LAYER â”‚
â”‚  (Local Tracking)    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â”‚ Track by identityId:
           â”‚ â€¢ score: 85
           â”‚ â€¢ completed: 95
           â”‚ â€¢ failed: 5
           â”‚
           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  3. ADVERTISEMENT    â”‚
â”‚  (P2P Network)       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â”‚ Multi-channel broadcast:
           â”‚ â€¢ DHT (persistence)
           â”‚ â€¢ GossipSub (real-time)
           â”‚ â€¢ P2P (direct)
           â”‚
           â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚   Network   â”‚
    â”‚ Distributionâ”‚
    â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
           â”‚                 â”‚                 â”‚
           â–¼                 â–¼                 â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚   DHT    â”‚      â”‚ GossipSubâ”‚     â”‚   P2P    â”‚
    â”‚ Storage  â”‚      â”‚  Topics  â”‚     â”‚ Broadcastâ”‚
    â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
         â”‚                 â”‚                 â”‚
         â”‚                 â”‚                 â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                           â”‚
                           â”‚ Receivers apply
                           â”‚ 7 security layers
                           â”‚
                           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  4. DISCOVERY LAYER              â”‚
â”‚  (Query & Filter)                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚
                   â”‚ findAvailableSigners({
                   â”‚   type: 'spend',
                   â”‚   minReputation: 70
                   â”‚ })
                   â”‚
                   â–¼
            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            â”‚  Filter by:  â”‚
            â”‚  â€¢ Identity  â”‚
            â”‚  â€¢ Reputationâ”‚
            â”‚  â€¢ Criteria  â”‚
            â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚
                   â”‚ Matching signers found
                   â”‚
                   â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  5. SIGNING SESSION              â”‚
â”‚  (MuSig2 Protocol)               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚
                   â”‚ â€¢ Request created
                   â”‚ â€¢ Participants join
                   â”‚ â€¢ Nonce exchange
                   â”‚ â€¢ Signature aggregation
                   â”‚
                   â–¼
            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
            â”‚   Session    â”‚
            â”‚  Complete!   â”‚
            â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
                   â”‚
                   â”‚ Update reputation
                   â”‚ for all participants
                   â”‚
                   â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  6. REPUTATION UPDATE            â”‚
â”‚  (Automatic Tracking)            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
           â”‚
           â”‚ For each participant:
           â”‚ â€¢ identity: 8f3a2b...
           â”‚ â€¢ outcome: success
           â”‚ â€¢ responseTime: 2.5s
           â”‚
           â–¼
    Update reputation score
    85 â†’ 86 âœ…

â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•

KEY INSIGHT: Identity flows through entire system
â€¢ Created on blockchain (immutable)
â€¢ Tracked in reputation (automatic)
â€¢ Referenced in advertisements (verified)
â€¢ Used in discovery (filtered)
â€¢ Updated after sessions (persistent)

Reputation CANNOT be discarded because it's tied to expensive identityId!
```

### Storage Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        Storage Architecture                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Lotus Blockchain (L1)                          â”‚
â”‚                                                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ Block N                                                     â”‚  â”‚
â”‚  â”‚                                                             â”‚  â”‚
â”‚  â”‚  Transaction: abc123...                                    â”‚  â”‚
â”‚  â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚  â”‚
â”‚  â”‚  â”‚ Output 0: OP_RETURN + 50 XPI BURN                    â”‚ â”‚  â”‚
â”‚  â”‚  â”‚                                                       â”‚ â”‚  â”‚
â”‚  â”‚  â”‚  6a                         OP_RETURN                â”‚ â”‚  â”‚
â”‚  â”‚  â”‚  04 4c 54 4d 53             LOKAD: "LTMS"            â”‚ â”‚  â”‚
â”‚  â”‚  â”‚  01                         Version 1                â”‚ â”‚  â”‚
â”‚  â”‚  â”‚  21 02abcd...               Public Key (33 bytes)    â”‚ â”‚  â”‚
â”‚  â”‚  â”‚  0d 313733...               Timestamp                â”‚ â”‚  â”‚
â”‚  â”‚  â”‚                                                       â”‚ â”‚  â”‚
â”‚  â”‚  â”‚  Satoshis: 50,000,000 ğŸ”¥    BURNED                   â”‚ â”‚  â”‚
â”‚  â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                   â”‚
â”‚  Confirmations: 6+ required for identity validity                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                               â–²
                               â”‚ Verification
                               â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    P2P Node Storage (L2)                          â”‚
â”‚                                                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ Local Cache (In-Memory)                                    â”‚  â”‚
â”‚  â”‚                                                             â”‚  â”‚
â”‚  â”‚  identityRegistry: Map<identityId, SignerIdentity>        â”‚  â”‚
â”‚  â”‚  â”œâ”€ 8f3a2b... â†’ {                                          â”‚  â”‚
â”‚  â”‚  â”‚     burnProof: {txId: 'abc123', amount: 50M},          â”‚  â”‚
â”‚  â”‚  â”‚     publicKey: '02abcd...',                            â”‚  â”‚
â”‚  â”‚  â”‚     keyHistory: [...]                                  â”‚  â”‚
â”‚  â”‚  â”‚   }                                                     â”‚  â”‚
â”‚  â”‚  â””â”€ 4d7e1c... â†’ {...}                                     â”‚  â”‚
â”‚  â”‚                                                             â”‚  â”‚
â”‚  â”‚  advertisementCache: Map<publicKey, Advertisement>        â”‚  â”‚
â”‚  â”‚  â”œâ”€ 02abcd... â†’ {                                          â”‚  â”‚
â”‚  â”‚  â”‚     identityId: '8f3a2b...',                           â”‚  â”‚
â”‚  â”‚  â”‚     criteria: {types: ['spend']},                      â”‚  â”‚
â”‚  â”‚  â”‚     expiresAt: 1730419200000                           â”‚  â”‚
â”‚  â”‚  â”‚   }                                                     â”‚  â”‚
â”‚  â”‚  â””â”€ 03ef12... â†’ {...}                                     â”‚  â”‚
â”‚  â”‚                                                             â”‚  â”‚
â”‚  â”‚  reputationScores: Map<identityId, Reputation>            â”‚  â”‚
â”‚  â”‚  â”œâ”€ 8f3a2b... â†’ {                                          â”‚  â”‚
â”‚  â”‚  â”‚     score: 85,                                         â”‚  â”‚
â”‚  â”‚  â”‚     completedSignings: 95,                             â”‚  â”‚
â”‚  â”‚  â”‚     failedSignings: 5                                  â”‚  â”‚
â”‚  â”‚  â”‚   }                                                     â”‚  â”‚
â”‚  â”‚  â””â”€ 4d7e1c... â†’ {...}                                     â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ Persistent Storage (Database/File)                         â”‚  â”‚
â”‚  â”‚                                                             â”‚  â”‚
â”‚  â”‚  â€¢ Reputation history (long-term)                          â”‚  â”‚
â”‚  â”‚  â€¢ Session records (audit trail)                           â”‚  â”‚
â”‚  â”‚  â€¢ Peer blacklist (permanent bans)                         â”‚  â”‚
â”‚  â”‚  â€¢ Key rotation history (security)                         â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                               â–²
                               â”‚ Replication
                               â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    DHT Network Storage (L3)                       â”‚
â”‚                                                                   â”‚
â”‚  Distributed across k=20 nodes per key                           â”‚
â”‚                                                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ Key: "musig2-signer:type:spend:8f3a2b..."                  â”‚  â”‚
â”‚  â”‚ Value: {                                                    â”‚  â”‚
â”‚  â”‚   identityId: "8f3a2b...",                                 â”‚  â”‚
â”‚  â”‚   publicKey: "02abcd...",                                  â”‚  â”‚
â”‚  â”‚   peerId: "12D3Koo...",                                    â”‚  â”‚
â”‚  â”‚   multiaddrs: ["/ip4/..."],                                â”‚  â”‚
â”‚  â”‚   signature: "...",                                        â”‚  â”‚
â”‚  â”‚   expiresAt: 1730419200000                                 â”‚  â”‚
â”‚  â”‚ }                                                           â”‚  â”‚
â”‚  â”‚ Stored on: [Node1, Node2, ..., Node20]                    â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ Key: "musig2-directory-index:spend"                        â”‚  â”‚
â”‚  â”‚ Value: {                                                    â”‚  â”‚
â”‚  â”‚   entries: [                                               â”‚  â”‚
â”‚  â”‚     {publicKey: "8f3a2b...", sig: "...", ts: ...},        â”‚  â”‚
â”‚  â”‚     {publicKey: "4d7e1c...", sig: "...", ts: ...},        â”‚  â”‚
â”‚  â”‚     ...                                                     â”‚  â”‚
â”‚  â”‚   ],                                                        â”‚  â”‚
â”‚  â”‚   version: 42,                                             â”‚  â”‚
â”‚  â”‚   lastUpdated: 1730419200000                               â”‚  â”‚
â”‚  â”‚ }                                                           â”‚  â”‚
â”‚  â”‚ Stored on: [Node5, Node8, ..., Node33]                    â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

REDUNDANCY LEVELS:
â€¢ L1 (Blockchain): 100% of network (full replication)
â€¢ L2 (Local): Per node (isolated)
â€¢ L3 (DHT): k=20 nodes (controlled replication)

FAILURE TOLERANCE:
â€¢ L1: Byzantine fault tolerance
â€¢ L2: Node restart = data loss (cache)
â€¢ L3: Up to k-1 node failures (19 nodes)
```

---

## Conclusion

This visual architecture shows how MuSig2 DHT coordination builds on:

1. **Blockchain-anchored identities** (LOKAD: LTMS)
   - 50 XPI burn = permanent identity
   - Cannot be discarded or faked

2. **Multi-layer security**
   - 7 defensive layers
   - Defense in depth

3. **Automatic reputation**
   - Tied to identityId
   - Updated on every session
   - Preserved across key rotation

4. **Multi-channel discovery**
   - DHT (persistent)
   - GossipSub (real-time)
   - P2P (direct)

5. **Scalable architecture**
   - O(log n) DHT lookups
   - k=20 replication
   - Efficient routing

**Key Insight**: Identity is the foundation. Everything else builds on it.

---

**Document Version**: 1.0.0  
**Last Updated**: November 3, 2025  
**Related**: [MUSIG2_DHT_SECURITY_ANALYSIS.md](./MUSIG2_DHT_SECURITY_ANALYSIS.md)
